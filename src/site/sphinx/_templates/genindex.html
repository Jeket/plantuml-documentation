{#
basic/genindex.html
~~~~~~~~~~~~~~~~~~~

Template for an "all-in-one" index.

:copyright: Copyright 2007-2018 by the Sphinx team, see AUTHORS.
:license: BSD, see LICENSE for details.
#}

{# Ashley Engelund: #}
{# added a CSS class name to use for all index entries that start with "see " #}

{% set see_class_name_with_space = " see" %}


{% macro indexentries(firstname, links) %}
    {%- if links -%}
        <a href="{{ links[0][1] }}">
            {%- if links[0][0] %}<strong>{% endif -%}
            {{ firstname|e }}
            {%- if links[0][0] %}</strong>{% endif -%}
        </a>

        {%- for ismain, link in links[1:] -%}
            , <a href="{{ link }}">{% if ismain %}<strong>{% endif -%}
            [{{ loop.index }}]
            {%- if ismain %}</strong>{% endif -%}
        </a>
        {%- endfor %}
    {%- else %}
        {{ firstname|e }}
    {%- endif %}
{% endmacro %}


{%- extends "layout.html" %}
{% set title = _('Index') %}
{% block body %}
    <style>
        .subentry {
            text-indent: 1em;
        }
    </style>

    <h1 id="index">{{ _('Index') }}</h1>

    <p>Since the template cannot break up an entry to exist in 2 columns, the columns are often unenven. In other words,
        using 'slice' only works when you have few subentries per entry.</p>
    <p><i>Blank links between entries also need to be taken into account.</i></p>


    <div class="genindex-jumpbox">
        {% for key, dummy in genindexentries -%}
            <a href="#{{ key }}"><strong>{{ key }}</strong></a>
            {% if not loop.last %}| {% endif %}
        {%- endfor %}
    </div>

    <div>
    <p>genindexcounts:</p>
    {{ genindexcounts }}
    </div>

    {% set totalsAll = namespace( size = 0 ) %}
    {% set totalsEntries = namespace( size = 0 ) %}
    {% set totalsSubentries = namespace( size = 0 ) %}
    {% set numEntriesForIndexKey = namespace( size = 0 ) %}
    {% set numSubentriesForIndexKey = namespace( size = 0 ) %}
    {% set numSubentriesForEntry = namespace( size = 0 ) %}

    {%- set column_len = namespace( max = ((entries | length) // 2) ) %}
    {%- set current_column = namespace( num = 1 ) %}

    {%- set entryIndex = namespace(count = 0 ) %}
    {%- for key, entries in genindexentries %}
        {% set numEntriesForIndexKey.size = 0 %}
        {% set numSubentriesForIndexKey.size = 0 %}

        <h2 id="{{ key }}" class="index-key">{{ key }}</h2>
        <table style="width: 100%" class="indextable genindextable">

                {# calculate the totals  #}
                {%- for entryname, (links, subitems, _) in entries %}
                    {%- set  numEntriesForIndexKey.size = loop.length %}

                    {%- if subitems %}

                        {%- for subentryname, subentrylinks in subitems %}
                            {%- set numSubentriesForEntry.size = loop.length %}
                        {%- endfor %}

                        {% set totalsAll.size = totalsAll.size + numSubentriesForEntry.size %}
                        {% set totalsSubentries.size = totalsSubentries.size + numSubentriesForEntry.size %}
                        {% set numSubentriesForIndexKey.size = numSubentriesForIndexKey.size + numSubentriesForEntry.size %}

                    {%- endif %}

                {%- endfor %}
                {% set totalsAll.size = totalsAll.size + numEntriesForIndexKey.size %}
                {% set totalsEntries.size = totalsEntries.size + numEntriesForIndexKey.size %}
{#
            <tr>
                <td style="text-align: right">
                    <ul>
                        <li><strong>Total number of items for this key
                            = {{ numEntriesForIndexKey.size + numSubentriesForIndexKey.size }}</strong></li>
                        <li>Num entries for this key = {{ numEntriesForIndexKey.size }}</li>
                        <li>Num subentries for this key = {{ numSubentriesForIndexKey.size }}</li>
                        <li> (Total for this key) / 2
                            = {{ (numEntriesForIndexKey.size + numSubentriesForIndexKey.size) // 2 }}</li>
                    </ul>
                </td>
            </tr>
#}

            {%- set column_len.max = ( numEntriesForIndexKey.size + numSubentriesForIndexKey.size) // 2 %}
            {%- set current_column.num = 1 %}

            <tr>
                {# display the information: #}
                {# {%- for column in entries | slice(2) if column %} #}

                {%- set td_start = namespace( html = '<td style="width: 33%; vertical-align: top;">' ) %}

                <td>genindexcounts[{{ (loop.index) - 1 }}] = {{ genindexcounts[(loop.index) - 1] }}</td>
                <td style="width: 33%; vertical-align: top;">
                {#  {% for entry in entries %} #}
                {#  <td style="width: 33%; vertical-align: top;"> #}
                    <ul>
                        {%- set totalLoop = namespace( count = 0) %}
                        {%- set indexentryLoop = namespace( count = loop.index) %}
                        {%- set subentryLoop = namespace( count = 0 ) %}

                        {%- for entryname, (links, subitems, _) in entries %}
                            {% set indexentryLoop.count = loop.index %}
                            {% set totalLoop.count = totalLoop.count + 1 %}

                            <li class="entry{{ see_class_name_with_space  if entryname.startswith("see ") }}">

                                {%- if subitems %}
                                    {{ indexentries(entryname, links) }}

                                    <ul>
                                        {%- for subentryname, subentrylinks in subitems %}
                                            {% set totalLoop.count = totalLoop.count + 1 %}

                                            <li class="subentry{{ see_class_name_with_space  if subentryname.startswith("see ") }}">{{ indexentries(subentryname, subentrylinks) }}</li>


                                            {%- if not loop.last and  (totalLoop.count > (column_len.max -1) and (current_column.num < 2 ) ) %}
                                                {%- set current_column.num = current_column.num + 1 %}
                                    </ul>
                            </li>
                    </ul>
                </td>

                <td style="width: 33%; vertical-align: top;">
                    <ul>
                          <li class="entry"><span class="entry-continued">{{ entryname }} continued</span>
                                <ul>
                                            {%- endif %}

                                        {%- endfor %}

                                    </ul>

                                {%- else -%}
                                    {{ indexentries(entryname, links) }}
                                {%- endif -%}
                                <br/>

                            </li>
                            {%- if loop.last or (totalLoop.count > column_len.max and (current_column.num < 2 ) ) %}
                                {%- set current_column.num = current_column.num + 1 %}
                    </ul>
            </td>
                                {%- if not loop.last %}
            <td style="width: 33%; vertical-align: top;">
                    <ul>
                                {%- endif %}
                            {%- endif %}
                        {%- endfor %}

            </tr>

        </table>

         {%- set entryIndex.count = entryIndex.count + 1 %}
    {% endfor %}

{% endblock %}

{% block sidebarrel %}
    {% if split_index %}
        <h4>{{ _('Index') }}</h4>
        <p>{% for key, dummy in genindexentries -%}
            <a href="{{ pathto('genindex-' + key) }}"><strong>{{ key }}</strong></a>
            {% if not loop.last %}| {% endif %}
        {%- endfor %}</p>

        <p><a href="{{ pathto('genindex-all') }}"><strong>{{ _('Full index on one page') }}</strong></a></p>
    {% endif %}
    {{ super() }}
{% endblock %}
